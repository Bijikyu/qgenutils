'use strict';const createPerformanceMonitor=require(./createPerformanceMonitor);describe('createPerformanceMonitor',()=>{let monitor;afterEach(()=>monitor?.isRunning()&& monitor.cleanup());it('should create a monitor instance',()=>{monitor=createPerformanceMonitor();expect(monitor).toHaveProperty('start');expect(monitor).toHaveProperty('stop');expect(monitor).toHaveProperty('recordRequest');expect(monitor).toHaveProperty('getMetrics');expect(monitor).toHaveProperty('getAlerts');expect(monitor).toHaveProperty('getHealthStatus');expect(monitor).toHaveProperty('cleanup')});it('should start and stop monitoring',()=>{monitor=createPerformanceMonitor({logger:{info: jest.fn(),warn: jest.fn(),error: jest.fn()}});expect(monitor.isRunning()).toBe(false);monitor.start();expect(monitor.isRunning()).toBe(true);monitor.stop();expect(monitor.isRunning()).toBe(false)});it('should record requests and calculate response time',()=>{monitor=createPerformanceMonitor();monitor.recordRequest(100);monitor.recordRequest(200);expect(monitor.getMetrics().responseTime).toBe(150)});it('should track throughput with rolling window',()=>{monitor=createPerformanceMonitor();monitor.recordRequest(100);monitor.recordRequest(100);monitor.recordRequest(100);expect(monitor.getMetrics().throughput).toBe(3)});it('should throw for invalid response time',()=>{monitor=createPerformanceMonitor();expect(()=>monitor.recordRequest(-100)).toThrow('Response time must be a non-negative number');expect(()=>monitor.recordRequest('string')).toThrow('Response time must be a non-negative number')});it('should return metrics snapshot',()=>{monitor=createPerformanceMonitor();const metrics=monitor.getMetrics();expect(metrics).toHaveProperty('memoryUsage');expect(metrics).toHaveProperty('heapUsedPercent')});it('should return alerts',()=>{monitor=createPerformanceMonitor();expect(Array.isArray(monitor.getAlerts())).toBe(true)});it('should return health status',()=>{monitor=createPerformanceMonitor();const health=monitor.getHealthStatus();expect(health).toHaveProperty('status');expect(health).toHaveProperty('metrics');expect(health).toHaveProperty('alerts');expect(health).toHaveProperty('recommendations')});it('should use custom thresholds',()=>{monitor=createPerformanceMonitor({maxCpuUsage: 50,maxMemoryUsage: 70});const thresholds=monitor.getThresholds();expect(thresholds.maxCpuUsage).toBe(50);expect(thresholds.maxMemoryUsage).toBe(70)});it('should reset counters',()=>{monitor=createPerformanceMonitor({logger:{info: jest.fn(),warn: jest.fn(),error: jest.fn()}});monitor.recordRequest(100);monitor.resetCounters();expect(monitor.getMetrics().responseTime).toBe(0)});it('should call onAlert callback',(done)=>{const onAlert=jest.fn();monitor=createPerformanceMonitor({maxEventLoopLag: 0,intervalMs: 100,onAlert,logger:{info: jest.fn(),warn: jest.fn(),error: jest.fn()}});monitor.start();setTimeout(()=>{monitor.stop();expect(onAlert).toHaveBeenCalled();done()},200)});it('should cleanup properly',()=>{monitor=createPerformanceMonitor({logger:{info: jest.fn(),warn: jest.fn(),error: jest.fn()}});monitor.start();monitor.cleanup();expect(monitor.isRunning()).toBe(false);expect(monitor.getAlerts()).toEqual([])})});