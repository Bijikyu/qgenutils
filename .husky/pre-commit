#!/usr/bin/env sh

. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Run ESLint on all staged files
npx lint-staged

# Check for syntax errors in critical files
echo "ğŸ“ Checking critical files for syntax errors..."

# Check demo server syntax
node -c examples/simple-demo-server.cjs
if [ $? -ne 0 ]; then
  echo "âŒ Syntax error in simple-demo-server.cjs"
  exit 1
fi

# Check API client syntax  
node -c examples/api-client-enhanced.js
if [ $? -ne 0 ]; then
  echo "âŒ Syntax error in api-client-enhanced.js"
  exit 1
fi

# Run a quick integration test
echo "ğŸ§ª Running quick integration test..."
node tests/integration/frontend-backend-integration.test.cjs --quick

if [ $? -eq 0 ]; then
  echo "âœ… Pre-commit checks passed!"
else
  echo "âŒ Integration test failed"
  exit 1
fi

echo "ğŸ¯ Pre-commit hooks completed successfully"